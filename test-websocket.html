<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocketÊé•Á∂ö„ÉÜ„Çπ„Éà</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            font-size: 14px;
        }
        input {
            width: 300px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #log {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #4CAF50;
            background-color: white;
        }
        .log-error {
            border-left-color: #f44336;
        }
        .log-message {
            border-left-color: #2196F3;
        }
    </style>
</head>
<body>
    <h1>WebSocketÊé•Á∂ö„ÉÜ„Çπ„Éà</h1>

    <div class="container">
        <h2>Êé•Á∂öË®≠ÂÆö</h2>
        <div>
            <label for="roomId">Room ID:</label>
            <input type="text" id="roomId" value="test-room" placeholder="„É´„Éº„É†ID„ÇíÂÖ•Âäõ">
        </div>
        <div>
            <button id="connectBtn" onclick="connect()">Êé•Á∂ö</button>
            <button id="disconnectBtn" onclick="disconnect()" disabled>ÂàáÊñ≠</button>
            <button onclick="clearLog()">„É≠„Ç∞„ÇØ„É™„Ç¢</button>
        </div>
    </div>

    <div class="container">
        <h2>„É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°</h2>
        <div>
            <input type="text" id="messageInput" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ" disabled>
            <button id="sendBtn" onclick="sendMessage()" disabled>ÈÄÅ‰ø°</button>
        </div>
    </div>

    <div class="container">
        <h2>„É≠„Ç∞</h2>
        <div id="log"></div>
    </div>

    <script>
        let ws = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function connect() {
            const roomId = document.getElementById('roomId').value;
            if (!roomId) {
                alert('Room ID„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const url = `ws://127.0.0.1:8787/ws?roomId=${encodeURIComponent(roomId)}`;
            log(`Êé•Á∂ö‰∏≠: ${url}`, 'info');

            try {
                ws = new WebSocket(url);

                ws.onopen = () => {
                    log('‚úÖ WebSocketÊé•Á∂ö„ÅåÁ¢∫Á´ã„Åï„Çå„Åæ„Åó„Åü', 'info');
                    document.getElementById('connectBtn').disabled = true;
                    document.getElementById('disconnectBtn').disabled = false;
                    document.getElementById('messageInput').disabled = false;
                    document.getElementById('sendBtn').disabled = false;
                };

                ws.onmessage = (event) => {
                    log(`üì® Âèó‰ø°: ${event.data}`, 'message');
                    try {
                        const data = JSON.parse(event.data);
                        log(`   (Ëß£ÊûêÊ∏à„Åø): ${JSON.stringify(data, null, 2)}`, 'message');
                    } catch (e) {
                        // JSON„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„Åù„ÅÆ„Åæ„ÅæË°®Á§∫
                    }
                };

                ws.onerror = (error) => {
                    log(`‚ùå „Ç®„É©„Éº: ${error.message || 'WebSocketÊé•Á∂ö„Ç®„É©„Éº'}`, 'error');
                    console.error('WebSocket error:', error);
                };

                ws.onclose = (event) => {
                    log(`üîå Êé•Á∂ö„ÅåÈñâ„Åò„Çâ„Çå„Åæ„Åó„Åü („Ç≥„Éº„Éâ: ${event.code}, ÁêÜÁî±: ${event.reason || '„Å™„Åó'})`, 'info');
                    document.getElementById('connectBtn').disabled = false;
                    document.getElementById('disconnectBtn').disabled = true;
                    document.getElementById('messageInput').disabled = true;
                    document.getElementById('sendBtn').disabled = true;
                };
            } catch (error) {
                log(`‚ùå Êé•Á∂ö„Ç®„É©„Éº: ${error.message}`, 'error');
            }
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }

        function sendMessage() {
            const message = document.getElementById('messageInput').value;
            if (!message || !ws || ws.readyState !== WebSocket.OPEN) {
                return;
            }

            try {
                // JSON„É°„ÉÉ„Çª„Éº„Ç∏„Å®„Åó„Å¶ÈÄÅ‰ø°
                const data = JSON.parse(message);
                ws.send(JSON.stringify(data));
                log(`üì§ ÈÄÅ‰ø°: ${message}`, 'info');
                document.getElementById('messageInput').value = '';
            } catch (e) {
                // JSON„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„Åù„ÅÆ„Åæ„ÅæÈÄÅ‰ø°
                ws.send(message);
                log(`üì§ ÈÄÅ‰ø°: ${message}`, 'info');
                document.getElementById('messageInput').value = '';
            }
        }

        // Enter„Ç≠„Éº„ÅßÈÄÅ‰ø°
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
